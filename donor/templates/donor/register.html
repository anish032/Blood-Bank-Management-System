{% extends 'base.html' %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <h2>Donor Registration</h2>
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="mb-3">
                <label>First Name *</label>
                <input type="text" name="first_name" class="form-control" required>
            </div>
            <div class="mb-3">
                <label>Last Name *</label>
                <input type="text" name="last_name" class="form-control" required>
            </div>
            <div class="mb-3">
                <label>Email *</label>
                <input type="email" name="email" class="form-control" required 
                       pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$">
                <small class="text-muted">Valid email required</small>
            </div>
            <div class="mb-3">
                <label>Password *</label>
                <input type="password" name="password" class="form-control" required minlength="6">
                <small class="text-muted">Minimum 6 characters</small>
            </div>
            <div class="mb-3">
                <label>Blood Group *</label>
                <select name="blood_group" class="form-control" required>
                    <option value="">Select Blood Group</option>
                    <option>A+</option><option>A-</option>
                    <option>B+</option><option>B-</option>
                    <option>O+</option><option>O-</option>
                    <option>AB+</option><option>AB-</option>
                </select>
            </div>
            <div class="mb-3">
                <label>Phone (Nepal) *</label>
                <input type="text" name="phone" class="form-control" required 
                       pattern="9[0-9]{9}" placeholder="98XXXXXXXX">
                <small class="text-muted">10 digits starting with 9</small>
            </div>
            <div class="mb-3">
                <label>Address *</label>
                <textarea name="address" class="form-control" required rows="3"></textarea>
            </div>
            <div class="mb-3">
                <label>Verification Document * (Citizenship/License)</label>
                <input type="file" name="verification_document" class="form-control" required accept="image/*">
                <small class="text-muted">Upload citizenship card or driver's license showing blood group</small>
            </div>
            <!-- Hidden fields for GPS coordinates -->
            <input type="hidden" name="latitude" id="latitude">
            <input type="hidden" name="longitude" id="longitude">
                    
            <div class="mb-3">
                <label class="form-label">City *</label>
                <input type="text" name="city" class="form-control" required value="Biratnagar">
            </div>
            
            <div class="mb-3">
                <button type="button" class="btn btn-outline-primary w-100" onclick="getLocation()" id="locationBtn">
                    üìç Get My Location (Optional)
                </button>
                <small class="text-muted" id="locationStatus">Click to automatically detect your location</small>
            </div>
            
            <script>
            function getLocation() {
                const btn = document.getElementById('locationBtn');
                const status = document.getElementById('locationStatus');
                
                if (navigator.geolocation) {
                    btn.disabled = true;
                    btn.textContent = '‚è≥ Getting location...';
                    
                    navigator.geolocation.getCurrentPosition(
                        function(position) {
                            document.getElementById('latitude').value = position.coords.latitude;
                            document.getElementById('longitude').value = position.coords.longitude;
                            btn.textContent = '‚úì Location Captured';
                            btn.classList.remove('btn-outline-primary');
                            btn.classList.add('btn-success');
                            status.textContent = 'Location: ' + position.coords.latitude.toFixed(4) + ', ' + position.coords.longitude.toFixed(4);
                            status.style.color = 'green';
                        },
                        function(error) {
                            btn.disabled = false;
                            btn.textContent = 'üìç Try Again';
                            status.textContent = 'Location access denied. You can still register without it.';
                            status.style.color = 'orange';
                        }
                    );
                } else {
                    status.textContent = 'Geolocation not supported by your browser';
                    status.style.color = 'red';
                }
            }
            </script>
            <button type="submit" class="btn btn-danger">Register</button>
            <a href="/donor/login" class="btn btn-link">Already registered? Login</a>
        </form>
    </div>
</div>
{% endblock %}